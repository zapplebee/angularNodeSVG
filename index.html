<!DOCTYPE html>
<html ng-app="nodeSVG">
<head>
<title>NodeSVG</title>
<meta name="viewport" content="width=450, user-scalable=no" />
<link href='http://fonts.googleapis.com/css?family=Muli' rel='stylesheet' type='text/css'>
<link href="main.css" rel="stylesheet" type="text/css">
<script src="//ajax.googleapis.com/ajax/libs/angularjs/1.2.25/angular.min.js"></script>
<script>
var nodeSVG = angular.module('nodeSVG',[]);


nodeSVG.run(function($rootScope,$window){


  $rootScope.halfWindow = window.innerWidth / 2;
  
  angular.element($window).bind('resize', function(){
    $rootScope.halfWindow = window.innerWidth / 2;
    $rootScope.$apply();
  });


});


nodeSVG.directive('nodeOut', function(){

  var controller = function($scope,$element){
  
  
    $scope.nodes = [];
  
    recur = function(parent){
    
      var tempArray = []
    
      angular.forEach(parent.children(), function(value, key){
    

      
      firstChild = angular.element(value.firstChild);
      
      if (angular.element(value).children().eq(1).length > 0){
        children = recur(angular.element(value).children().eq(1));
      }else{
        children = {}
      }
      
      var objA = {
      'title' : firstChild.html(),
      'radius': firstChild.attr('radius'),
      'angle' : firstChild.attr('angle'),
      'children' : children
      }

      tempArray.push(objA);
    
    });
    

    return tempArray;
    
    }
    
    $scope.nodes = (recur($element));
    console.log($scope.nodes);
    
  

    

    

  
  };
  
  //var template = '{{nodes}}';
  
  
  return {

    restrict: 'EA',
    scope: {
    },
    controller: controller,
    //template: template
  };

});


nodeSVG.controller('svgCtrl', function($scope,$rootScope,$window){



});
</script>
</head>
<body>


<ul node-out>
  <li><a href="#" radius="100" angle="30">Test</a></li>
  <li><a href="#" radius="0" angle="0">Test</a>
    <ul>
    <li><a href="#" radius="0" angle="0">Test</a></li>
    <li><a href="#" radius="0" angle="0">Test</a></li>
    <li><a href="#" radius="0" angle="0">Test</a></li>
    <li><a href="#" radius="0" angle="0">Test</a></li>
    </ul>
  </li>
  <li><a href="#" radius="0" angle="0">Test</a></li>
</ul>

<svg ng-controller="svgCtrl" controversion="1.1" xmlns="http://www.w3.org/2000/svg">






<g tranform="" ng-attr-transform="translate({{halfWindow}},60)">
  <g>
    <path d="M 0 0 L 200 200" />
    <circle cx="0" cy="0" r="50"/>
    <foreignObject width="100" height="100" x="-50" y="-50">
    <a class="mainNode">Main Node</a>
    </foreignObject>
  </g>

</g>

</svg>
<div>
</div>
</body>
</html>