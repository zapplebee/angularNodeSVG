<!DOCTYPE html>
<html ng-app="nodeSVG">
<head>
<title>NodeSVG</title>
<meta name="viewport" content="width=450, user-scalable=no" />
<link href='http://fonts.googleapis.com/css?family=Muli' rel='stylesheet' type='text/css'>
<link href="main.css" rel="stylesheet" type="text/css">
<script src="https://ajax.googleapis.com/ajax/libs/angularjs/1.3.13/angular.min.js"></script>
<script src="https://ajax.googleapis.com/ajax/libs/jquery/2.1.3/jquery.min.js"></script>
<script>
var nodeSVG = angular.module('nodeSVG',[]);


nodeSVG.run(function($rootScope,$window){

  $rootScope.halfWindow = window.innerWidth / 2;
  
  angular.element($window).bind('resize', function(){
    $rootScope.halfWindow = window.innerWidth / 2;
    $rootScope.$apply();
  });

});


nodeSVG.directive('nodeOut', function(){

  var controller = function($scope,$element,$transclude){
  
    makeMap = function(collection,origin){
    
      var origin = origin || {'x':0,'y':0};
      
      
     var plotX = function(innerDegree,innerRadius){
      return innerRadius * Math.cos(innerDegree*Math.PI/180);
     }
        
     var plotY = function(innerDegree,innerRadius){
      return innerRadius * Math.sin(innerDegree*Math.PI/180);
     }
      
      
      
      var returner = [];
      var nodeCount = collection.length;
      var keyAngle;
      console.log(nodeCount % 2);
      var adjustedNodeCount = (2 * nodeCount) - 2;
      if(!(nodeCount % 2)){
        adjustedNodeCount = (2 * nodeCount) - 2;
      }else{
        adjustedNodeCount = (2 * nodeCount) - 2;
      }
      
      console.log('adjustedNodeCount: ' + adjustedNodeCount);
      
      keyAngle = 360/adjustedNodeCount | 0;
      
      console.log(' keyAngle:' + keyAngle)
      console.log('nodeCount:' + nodeCount);
      
      

        
      var getRadius = function(givenAngle,paddedRadius){

        var angleA = givenAngle / 2;
        var radius = (paddedRadius / Math.sin(angleA * (Math.PI / 180)));
        if (radius > 120){
          return radius;
        }else{
          return 120;
        }
      
      }


      var radius;
      if(nodeCount > 1){
        radius = getRadius(keyAngle,60);
      }
      else{
        radius = 0;
      }
      
      
      
      
      angular.forEach(collection,function(val,key){
      
        var $link = $(val).children('a').first();
        var title = $link.html();
        var angle = key * keyAngle;


        var href = $link.attr('href');
        var coordinates = {'x':plotX(angle,radius),'y':plotY(angle,radius)};
        var $childCollection = $(val).children('ul').children('li');
        var children;
        if($childCollection.length > 0){
          children = makeMap($childCollection,coordinates);
        }else
        {
          children = [];
        }

        
        
        var tempObj = {
          'title'      : title,
          'href'       : href,
          'children'   : children,
          'origin'     : origin,
          'coordinates': coordinates
          
        }
        returner.push(tempObj);

      });
    
      return (returner);
    
    }

    $transclude(function(clone,scope){

      $cloneElement = $(clone);
      $scope.nodeMap = makeMap($cloneElement.filter('li'));
      console.log($scope.nodeMap);
         
    });

  };

  return {

    restrict: 'A',
    replace: true,
    transclude:true,
    scope: {},
    controller:controller,
    templateUrl: 'dirNode.html',
  };

});



nodeSVG.directive('nodeBar', function ($compile) {
      
    var controller = function ($scope,$interval) {


        $scope.scale = 1;
   }
      

        
     var template = '<g>' +
                    '<path ng-attr-d="M 0 0 L {{node.coordinates.x}} {{node.coordinates.y}}" stroke="#999999" stroke-width="5" />' +
                    '<foreignObject ng-attr-x="{{node.coordinates.x - 50}}" ng-attr-y="{{node.coordinates.y - 50}}" width="100" height="100"><a ng-attr-href="{{node.href}}">{{node.title}}</a></foreignObject>' +
                    '</g>';

      return {
          restrict: 'EA',
          scope: {
              node: '='
          },
          controller: controller,
          template: template
      };
});


nodeSVG.controller('svgCtrl', function($scope,$rootScope,$window){



});
</script>
</head>
<body>

<ul node-out>
  <li><a href="#">Home</a>
  <ul>
  <li><a href="#">Test B</a></li>
  <li><a href="#">Test B</a></li>
  <li><a href="#">Test B</a></li>
  <li><a href="#">Test B</a></li>
  <li><a href="#">Test B</a></li>
  <li><a href="#">Test B</a></li>
  </li>
  <ul>
</ul>

<div>
</div>
</body>
</html>