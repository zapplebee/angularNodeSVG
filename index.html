<!DOCTYPE html>
<html ng-app="nodeSVG">
<head>
<title>NodeSVG</title>
<meta name="viewport" content="width=450, user-scalable=no" />
<link href='http://fonts.googleapis.com/css?family=Muli' rel='stylesheet' type='text/css'>
<link href="main.css" rel="stylesheet" type="text/css">
<script src="https://ajax.googleapis.com/ajax/libs/angularjs/1.3.13/angular.min.js"></script>
<script src="https://ajax.googleapis.com/ajax/libs/jquery/2.1.3/jquery.min.js"></script>
<script>
var nodeSVG = angular.module('nodeSVG',[]);


nodeSVG.run(function($rootScope,$window){

  $rootScope.halfWindow = window.innerWidth / 2;
  
  angular.element($window).bind('resize', function(){
    $rootScope.halfWindow = window.innerWidth / 2;
    $rootScope.$apply();
  });

});


nodeSVG.directive('nodeOut', function(){

  var controller = function($scope,$element,$transclude){
  
    makeMap = function(collection){
      var returner = [];
      
      angular.forEach(collection,function(val,key){
        
        var $link = $(val).children('a').first();
        var title = $link.html();
        var angle = $link.attr('angle');
        var radius = $link.attr('radius');
        var href = $link.attr('href');
        
        var $childCollection = $(val).children('ul').children('li');
        
        var children = makeMap($childCollection);
        
        var tempObj = {
          'title'    : title,
          'angle'    : angle,
          'radius'   : radius,
          'href'     : href,
          'children' : children,
          
        }
        
        returner.push(tempObj);

      });
    
      return (returner);
    
    }

    $transclude(function(clone,scope){

      $cloneElement = $(clone);
      $scope.nodeMap = makeMap($cloneElement.filter('li'));
         
    });

  };

  return {

    restrict: 'A',
    replace: true,
    transclude:true,
    scope: {},
    controller:controller,
    templateUrl: 'dirNode.html',
  };

});



nodeSVG.directive('nodeBar', function ($compile) {
      
    var controller = function ($scope,$interval) {

        console.log($scope.node)

        $scope.scale = 1;
      
        var plot = function(degree,radius,wantX){
        
          var x = radius * Math.cos(degree*Math.PI/180);
          var y = radius * Math.sin(degree*Math.PI/180);
          
          if(wantX){
            return x;
          }else{
            return y;
          }
        
        }
        
        $scope.plotted = {
          'x' : plot($scope.node.angle,$scope.node.radius,true),
          'y' : plot($scope.node.angle,$scope.node.radius)
        }

      
   }
      

        
     var template = '<g>' +
                 '<path ng-attr-d="M 0 0 L {{plotted.x}} {{plotted.y}}" stroke="#999999" stroke-width="5" />' +
                 '<circle ng-attr-cx="{{plotted.x}}" style="fill: #34CF0F" ng-attr-cy="{{plotted.y * scale}}" r="50" stroke="#999999" stroke-width="5" />' +
                 '<foreignObject ng-attr-x="{{plotted.x - 50}}" ng-attr-y="{{plotted.y - 50}}" width="100" height="100"><a ng-attr-href="{{node.href}}">{{node.title}}</a></foreignObject>'+
     
                 '</g>';

      return {
          restrict: 'EA',
          scope: {
              node: '='
          },
          controller: controller,
          template: template
      };
});


nodeSVG.controller('svgCtrl', function($scope,$rootScope,$window){



});
</script>
</head>
<body>

<ul node-out>

  <li><a href="#" radius="200" angle="33">Another Link</a>
    <ul>
    <li><a href="#" radius="300" angle="44">Test B1</a></li>
    <li><a href="#" radius="0" angle="0">Test B2</a></li>
    <li><a href="#" radius="0" angle="0">Test B3</a></li>
    <li><a href="#" radius="0" angle="0">Test B5</a></li>
    </ul>
  </li>
  <li><a href="#" radius="230" angle="160">Test C</a></li>
  <li><a href="#" radius="0" angle="0">Home</a></li>
</ul>

<div>
</div>
</body>
</html>