<!DOCTYPE html>
<html ng-app="nodeSVG">
<head>
<title>NodeSVG</title>
<meta name="viewport" content="width=450, user-scalable=no" />
<link href='http://fonts.googleapis.com/css?family=Muli' rel='stylesheet' type='text/css'>
<link href="main.css" rel="stylesheet" type="text/css">
<script src="https://ajax.googleapis.com/ajax/libs/angularjs/1.3.13/angular.min.js"></script>
<script src="https://ajax.googleapis.com/ajax/libs/jquery/2.1.3/jquery.min.js"></script>
<script>
var nodeSVG = angular.module('nodeSVG',[]);


nodeSVG.run(function($rootScope,$window){

  $rootScope.halfWindow = window.innerWidth / 2;
  
  angular.element($window).bind('resize', function(){
    $rootScope.halfWindow = window.innerWidth / 2;
    $rootScope.$apply();
  });

});


nodeSVG.directive('nodeOut', function(){

  var controller = function($scope,$element,$transclude){
  
    makeMap = function(collection){
      var returner = [];
      
      angular.forEach(collection,function(val,key){
        
        var $link = $(val).children('a').first();
        var title = $link.html();
        var angle = $link.attr('angle');
        var radius = $link.attr('radius');
        
        var $childCollection = $(val).children('ul').children('li');
        
        var children = makeMap($childCollection);
        
        var tempObj = {
          'title'    : title,
          'angle'    : angle,
          'radius'   : radius,
          'children' : children
        }
        
        returner.push(tempObj);

      });
    
      return (returner);
    
    }

    $transclude(function(clone,scope){

      $cloneElement = $(clone);
      $scope.x = makeMap($cloneElement.filter('li'));
         
    });

  };

  var template = '<pre>{{x}}</pre>';

  return {

    restrict: 'A',
    replace: true,
    transclude:true,
    scope: {},
    controller:controller,
    template: template,
  };

});


nodeSVG.controller('svgCtrl', function($scope,$rootScope,$window){



});
</script>
</head>
<body>

<ul node-out>
  <li><a href="#" radius="100" angle="30">Test A</a></li>
  <li><a href="#" radius="0" angle="0">Test Bx</a>
    <ul>
    <li><a href="#" radius="0" angle="0">Test B1</a></li>
    <li><a href="#" radius="0" angle="0">Test B2</a></li>
    <li><a href="#" radius="0" angle="0">Test B3</a></li>
    <li><a href="#" radius="0" angle="0">Test B5</a></li>
    </ul>
  </li>
  <li><a href="#" radius="0" angle="0">Test C</a></li>
</ul>
<svg ng-controller="svgCtrl" controversion="1.1" xmlns="http://www.w3.org/2000/svg">






<g tranform="" ng-attr-transform="translate({{halfWindow}},60)">
  <g>
    <path d="M 0 0 L 200 200" />
    <circle cx="0" cy="0" r="50"/>
    <foreignObject width="100" height="100" x="-50" y="-50">
    <a class="mainNode">Main Node</a>
    </foreignObject>
  </g>

</g>

</svg>
<div>
</div>
</body>
</html>